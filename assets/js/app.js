/* ---------- i18n dictionary ---------- */
const i18n = {
  en: {
    /* Nav */
    nav_home: "Home",
    nav_about: "About",
    nav_work: "Our Work",
    nav_donate: "Donate",
    nav_visit: "Visit & Volunteer",
    nav_gallery: "Gallery",
    nav_contact: "Contact",
    nav_legal: "Legal",
    lang_label_en: "EN",
    lang_label_hi: "हिन्दी",

    /* Hero / Fast facts */
    hero_title: "Welcome to Shri Jivdaya Gaushala, Bhinmal",
    hero_intro:
      "Rajasthan’s sanctuary of compassion for over 80 years. As the first Gaushala of Jalore district, we care for 2,150+ animals across expansive shelters and green spaces—with medical care, nutritious feed and dignity for every life.",
    hero_cta_donate: "Donate Now",
    hero_cta_visit: "Visit/Volunteer",
    fastfacts_title: "Fast Facts",
    stat_years_value: "80+",
    stat_years_label: "years of service",
    stat_animals_value: "~{animals_total}",
    stat_animals_label: "animals cared for",
    stat_wards_value: "{wards}",
    stat_wards_label: "animal wards",
    stat_hospital_value: "{hospital}",
    stat_hospital_label: "animal hospital",
    stat_fodder_value: "{fodder_halls}",
    stat_fodder_label: "dry-fodder halls",
    stat_trees_value: "~{trees}",
    stat_trees_label: "shade-giving trees",
    stat_cost_value: "₹1.05L",
    stat_cost_label: "daily running cost",
    fact_years: "80+ years of service",
    fact_animals: "~{animals_total} animals (cows, bulls, goats, sheep, buffaloes, mares)",
    fact_wards: "{wards} animal wards",
    fact_hospital: "{hospital} animal hospital",
    fact_fodder: "{fodder_halls} dry-fodder halls",
    fact_borewell: "{borewells} borewells + {dharam_kanta} dharam-kanta (weighbridge)",
    fact_trees: "~{trees} shade-giving trees (neem, khejri, sisam)",
    fact_trees_goal: "Goal: +{trees_goal_per_year} trees/year",
    fact_trees_planted: "~{trees_planted_2024_2025} planted in 2024–25",
    fact_feeding:
      "Daily feeding: dry fodder + 1–2 truckloads of green fodder; lapsi on auspicious days",

    /* About */
    about_title: "About Us",
    about_history:
      "First Gaushala of Jalore district; serving mute, abandoned, injured animals for 80+ years in holy town Bhinmal (Marwar, Rajasthan).",
    about_campuses: "Campuses/areas:",
    about_mirpura: "Mirpura Gaushala: ~500 bigha",
    about_panch: "Panch Kuwa Gaushala: ~180 bigha",
    about_residents: "Combined residents: ~2,150 animals.",
    about_facilities:
      "Facilities include wards, hospital, fodder halls, staff quarters, saints’ stay, birdhouse & chabutra, water infrastructure.",

    /* Work */
    work_title: "Our Work",
    work_care: "Animal Care",
    work_care_desc:
      "Cows, bulls, goats, sheep, buffaloes, mares; rescued from abandonment or slaughter; peaceful habitat.",
    work_medical: "Medical & Hospital",
    work_medical_desc: "On-site treatment and care for injured or sick animals.",
    work_feed: "Feeding & Nutrition",
    work_feed_desc: "Daily dry + green fodder; lapsi on festivals.",
    work_green: "Green Drive",
    work_green_desc: "1,000+ trees; +100/year; 250 planted in 2024–25.",
    work_infra: "Infrastructure",
    work_infra_desc: "Wards, fodder halls, borewells, dharam-kanta.",

    /* Donate */
    donate_title: "Donate",
    donate_intro:
      "During sacred days like Paryushan and throughout the year, your support sustains over two thousand lives. The Gaushala’s daily operating cost is approx ₹1.05 lakh.",
    donate_disclaimer:
      "For 80G/receipt needs, ensure you enter your full name, email, phone, and address in the form.",
    donate_options: "Donation Options",
    donate_one_time: "One-time",
    donate_monthly: "Monthly",
    donate_sponsor: "Sponsor a Cow",
    donate_feed: "Feed for a Day",
    donate_medical: "Medical Care",
    donate_tree: "Plant a Tree",
    donate_bank: "Bank Transfer Details",
    donate_form_title: "Donation Intent Form",
    donate_name: "Name",
    donate_email: "Email",
    donate_phone: "Phone",
    donate_address: "Address",
    donate_pan: "PAN (optional)",
    donate_amount: "Amount (₹)",
    donate_purpose: "Purpose",
    donate_submit: "Submit",
    donate_success:
      "Thank you! We have saved your intent. The team will contact you.",

    /* Visit / Volunteer */
    visit_title: "Visit & Volunteer",
    visit_hours: "Visiting hours: TBD",
    visit_guidelines: "Follow safety & hygiene guidelines during visit.",
    volunteer_roles: "Volunteer roles include animal care, plantation, awareness drives.",
    volunteer_form_title: "Volunteer Form",
    volunteer_success: "Thank you for your interest! We'll get in touch.",
    map_placeholder: "Map placeholder",

    /* Gallery */
    gallery_title: "Gallery",

    /* Contact */
    contact_title: "Contact",
    contact_form_title: "Contact Form",
    contact_success: "Thanks for reaching out! We'll respond soon.",

    /* Legal */
    legal_title: "Legal",
    privacy_policy: "Privacy Policy",
    terms_conditions: "Terms & Conditions",
    refund_policy: "Refund/Cancellation",
    compliance: "Compliance",
    documents_pending: "Documents pending upload by NGO.",

    /* Footer / misc */
    footer_motto: "Made with ♥ for animals",
    footer_address: "Address: Mirpura Road, Bhinmal, Rajasthan (placeholder)",
    footer_quick_links: "Quick Links",
    footer_social: "Connect",
    copy: "Copy",
    copied: "Copied!",
    help_phone: "We will only use this to coordinate your visit.",
    form_message: "Message",
    cta_whatsapp: "WhatsApp",
    role_president: "President",
    role_vpresident: "Vice President",
    role_secretary: "Secretary",
    role_treasurer: "Treasurer",
    role_joint_secretary: "Joint Secretary"
  },

  hi: {
    /* Nav */
    nav_home: "होम",
    nav_about: "परिचय",
    nav_work: "हमारा कार्य",
    nav_donate: "दान",
    nav_visit: "भेंट व सेवा",
    nav_gallery: "गैलरी",
    nav_contact: "संपर्क",
    nav_legal: "कानूनी",
    lang_label_en: "EN",
    lang_label_hi: "हिन्दी",

    /* Hero / facts */
    hero_title: "श्री जीवदया गौशाला, भीनमाल में आपका स्वागत है",
    hero_intro:
      "करुणा की शरणस्थली—80 वर्षों से सेवा। जालौर जिले की प्रथम गौशाला के रूप में, हम 2,150+ पशुओं की हरियाली और सम्मानपूर्ण देखभाल करते हैं।",
    hero_cta_donate: "अभी दान करें",
    hero_cta_visit: "भेंट/सेवा करें",
    fastfacts_title: "त्वरित तथ्य",
    stat_years_value: "80+",
    stat_years_label: "वर्षों की सेवा",
    stat_animals_value: "~{animals_total}",
    stat_animals_label: "पशु देखरेख में",
    stat_wards_value: "{wards}",
    stat_wards_label: "पशु वार्ड",
    stat_hospital_value: "{hospital}",
    stat_hospital_label: "पशु अस्पताल",
    stat_fodder_value: "{fodder_halls}",
    stat_fodder_label: "सूखा चारा हॉल",
    stat_trees_value: "~{trees}",
    stat_trees_label: "छायादार वृक्ष",
    stat_cost_value: "₹1.05लाख",
    stat_cost_label: "दैनिक व्यय",
    fact_years: "80+ वर्षों की सेवा",
    fact_animals: "~{animals_total} पशु (गाय, बैल, बकरी, भेड़, भैंस, घोड़ी)",
    fact_wards: "{wards} पशु वार्ड",
    fact_hospital: "{hospital} पशु अस्पताल",
    fact_fodder: "{fodder_halls} सूखा चारा हॉल",
    fact_borewell: "{borewells} बोरवेल + {dharam_kांटा} धर्मकांटा",
    fact_trees: "~{trees} छायादार वृक्ष (नीम, खेजड़ी, सिसम)",
    fact_trees_goal: "लक्ष्य: +{trees_goal_per_year} वृक्ष/वर्ष",
    fact_trees_planted: "~{trees_planted_2024_2025} वृक्ष 2024–25 में",
    fact_feeding:
      "दैनिक भोजन: सूखा चारा + 1–2 ट्रक हरा चारा; विशेष दिनों में लापसी",

    /* About */
    about_title: "हमारे बारे में",
    about_history:
      "जालौर जिले की प्रथम गौशाला; 80+ वर्षों से भीनमाल में अबोल, परित्यक्त, घायल पशुओं की सेवा।",
    about_campuses: "परिसर/क्षेत्र:",
    about_mirpura: "मीरपुरा गौशाला: ~500 बीघा",
    about_panch: "पांच कुआं गौशाला: ~180 बीघा",
    about_residents: "कुल निवासियों: ~2,150 पशु।",
    about_facilities:
      "सुविधाएँ: वार्ड, अस्पताल, चारा हॉल, स्टाफ क्वार्टर, संत निवास, पक्षीघर व चबूतरा, जल संरचना।",

    /* Work */
    work_title: "हमारा कार्य",
    work_care: "पशु देखभाल",
    work_care_desc:
      "गाय, बैल, बकरी, भेड़, भैंस, घोड़ी; परित्यक्त या वध से बचाए गए; शांत आवास।",
    work_medical: "चिकित्सा व अस्पताल",
    work_medical_desc: "घायल या बीमार पशुओं का स्थल पर उपचार।",
    work_feed: "भोजन व पोषण",
    work_feed_desc: "दैनिक सूखा + हरा चारा; त्योहारों पर लापसी।",
    work_green: "हरित अभियान",
    work_green_desc: "1,000+ वृक्ष; +100/वर्ष; 2024–25 में 250 लगाए।",
    work_infra: "बुनियादी ढांचा",
    work_infra_desc: "वार्ड, चारा हॉल, बोरवेल, धर्मकांटा।",

    /* Donate */
    donate_title: "दान",
    donate_intro:
      "पर्युषण जैसे पावन दिनों सहित पूरे वर्ष, आपका सहयोग दो हजार से अधिक प्राणियों का सहारा है। दैनिक व्यय लगभग ₹1.05 लाख।",
    donate_disclaimer:
      "80G/रसीद हेतु कृपया फॉर्म में पूरा नाम, ईमेल, फोन, पता भरें।",
    donate_options: "दान विकल्प",
    donate_one_time: "एकमुश्त",
    donate_monthly: "मासिक",
    donate_sponsor: "एक गाय गोद लें",
    donate_feed: "एक दिन का भोजन",
    donate_medical: "चिकित्सा सहायता",
    donate_tree: "वृक्ष लगाएं",
    donate_bank: "बैंक ट्रांसफर विवरण",
    donate_form_title: "दान अभिरुचि फॉर्म",
    donate_name: "नाम",
    donate_email: "ईमेल",
    donate_phone: "फोन",
    donate_address: "पता",
    donate_pan: "PAN (वैकल्पिक)",
    donate_amount: "राशि (₹)",
    donate_purpose: "उद्देश्य",
    donate_submit: "जमा करें",
    donate_success:
      "धन्यवाद! हमने आपकी अभिरुचि सहेज ली है। टीम आपसे संपर्क करेगी।",

    /* Visit / Volunteer */
    visit_title: "भेंट व सेवा",
    visit_hours: "भेंट समय: TBD",
    visit_guidelines: "भेंट के दौरान सुरक्षा व स्वच्छता निर्देशों का पालन करें।",
    volunteer_roles: "सेवा भूमिकाएँ: पशु देखभाल, वृक्षारोपण, जागरूकता अभियान।",
    volunteer_form_title: "सेवक फॉर्म",
    volunteer_success: "रुचि के लिए धन्यवाद! हम संपर्क करेंगे।",
    map_placeholder: "मानचित्र प्लेसहोल्डर",

    /* Gallery */
    gallery_title: "गैलरी",

    /* Contact */
    contact_title: "संपर्क",
    contact_form_title: "संपर्क फॉर्म",
    contact_success: "धन्यवाद! हम शीघ्र उत्तर देंगे।",

    /* Legal */
    legal_title: "कानूनी",
    privacy_policy: "गोपनीयता नीति",
    terms_conditions: "नियम व शर्तें",
    refund_policy: "रिफंड/रद्द",
    compliance: "अनुपालन",
    documents_pending: "दस्तावेज़ अपलोड लंबित हैं।",

    /* Footer / misc */
    footer_motto: "जानवरों के लिए प्रेम से बनाया गया",
    footer_address: "पता: मीरपुरा रोड, भीनमाल, राजस्थान (placeholder)",
    footer_quick_links: "त्वरित लिंक",
    footer_social: "सोशल",
    copy: "कॉपी",
    copied: "कॉपी हो गया!",
    help_phone: "हम केवल समन्वय हेतु उपयोग करेंगे।",
    form_message: "संदेश",
    cta_whatsapp: "व्हाट्सऐप",
    role_president: "अध्यक्ष",
    role_vpresident: "उपाध्यक्ष",
    role_secretary: "सचिव",
    role_treasurer: "कोषाध्यक्ष",
    role_joint_secretary: "संयुक्त सचिव"
  }
};

/* ---------- globals ---------- */
let currentLang = "en";
let siteData = {
  animals_total: "2150+",
  wards: "15",
  hospital: "1",
  fodder_halls: "3",
  trees: "1000+",
  borewells: "2",
  dharam_kanta: "1",
  trees_goal_per_year: "100",
  trees_planted_2024_2025: "250"
};

/* ---------- init ---------- */
document.addEventListener("DOMContentLoaded", () => {
  renderHeaderFooter();

  // Load dynamic site data if available
  fetch("assets/data/site.json")
    .then((r) => (r.ok ? r.json() : null))
    .then((data) => {
      if (data) siteData = { ...siteData, ...data };
    })
    .finally(() => {
      currentLang = localStorage.getItem("lang") || "en";
      setLanguage(currentLang);
      setActiveNav();
    });

  // Event delegation
  document.body.addEventListener("click", handleClicks);

  // Forms + year
  setupForms();
  updateYear();
});

/* ---------- header + footer injection ---------- */
function renderHeaderFooter() {
  const header = document.getElementById("site-header");
  if (header) {
    header.innerHTML = `
      <nav class="nav container" aria-label="Primary">
        <a href="index.html" class="logo" aria-label="Home">
          <img src="assets/img/logo.svg" alt="Logo" width="40" height="40" />
        </a>
        <div class="nav-links">
          <a href="index.html" data-i18n="nav_home">Home</a>
          <a href="about.html" data-i18n="nav_about">About</a>
          <a href="work.html" data-i18n="nav_work">Our Work</a>
          <a href="gallery.html" data-i18n="nav_gallery">Gallery</a>
          <a href="donate.html" data-i18n="nav_donate">Donate</a>
          <a href="visit-volunteer.html" data-i18n="nav_visit">Visit / Volunteer</a>
          <a href="contact.html" data-i18n="nav_contact">Contact</a>
          <a href="legal.html" data-i18n="nav_legal">Legal</a>
        </div>
        <div class="lang-switch" aria-label="Language">
          <button class="lang-toggle" data-lang="en" data-i18n="lang_label_en">EN</button>
          |
          <button class="lang-toggle" data-lang="hi" data-i18n="lang_label_hi">हिन्दी</button>
        </div>
      </nav>
    `;
  }

  const footer = document.getElementById("site-footer");
  if (footer) {
    footer.innerHTML = `
      <div class="container footer-grid">
        <div>
          <img src="assets/img/logo.svg" alt="Logo" width="80" height="80" />
          <p>Shri Jivdaya Gaushala, Bhinmal</p>
          <p data-i18n="footer_address">Address: Mirpura Road, Bhinmal, Rajasthan (placeholder)</p>
        </div>
        <div>
          <h3 data-i18n="footer_quick_links">Quick Links</h3>
          <ul>
            <li><a href="index.html" data-i18n="nav_home">Home</a></li>
            <li><a href="about.html" data-i18n="nav_about">About</a></li>
            <li><a href="work.html" data-i18n="nav_work">Our Work</a></li>
            <li><a href="donate.html" data-i18n="nav_donate">Donate</a></li>
          </ul>
        </div>
        <div>
          <h3 data-i18n="footer_social">Connect</h3>
          <div class="social-icons">
            <a href="#" aria-label="Facebook">
              <svg viewBox="0 0 24 24" width="24" height="24"><path d="M22 12a10 10 0 1 0-11.5 9.9v-7h-2v-2.9h2v-2.2c0-2 1.2-3.1 3-3.1.9 0 1.8.1 1.8.1v2h-1c-1 0-1.3.6-1.3 1.2v2h2.2L16 14.9h-2v7A10 10 0 0 0 22 12"/></svg>
            </a>
            <a href="#" aria-label="Twitter">
              <svg viewBox="0 0 24 24" width="24" height="24"><path d="M19.5 7.4c.01.2.01.4.01.6 0 6.2-4.7 13.4-13.4 13.4-2.7 0-5.1-.8-7.2-2.2.37.04.74.06 1.12.06 2.2 0 4.3-.75 5.9-2-2-.04-3.7-1.4-4.3-3.3.28.05.57.07.87.07.42 0 .84-.06 1.23-.16-2.1-.42-3.7-2.3-3.7-4.5v-.06c.62.35 1.3.56 2 .58-1.2-.8-2-2.2-2-3.7 0-.82.22-1.6.62-2.3 2.3 2.8 5.8 4.6 9.7 4.8-.08-.33-.12-.68-.12-1.03 0-2.5 2-4.6 4.6-4.6 1.3 0 2.5.55 3.3 1.4 1-.2 2-.55 2.8-1-.33 1-.99 1.8-1.8 2.3.9-.1 1.7-.35 2.5-.7-.6.9-1.3 1.8-2.1 2.4z"/></svg>
            </a>
          </div>
        </div>
      </div>
      <div class="container">
        <p>&copy; <span id="year"></span> Shri Jivdaya Gaushala, Bhinmal. <span data-i18n="footer_motto">Made with ♥ for animals</span></p>
      </div>
    `;
  }
}

/* ---------- active nav ---------- */
function setActiveNav() {
  const current = location.pathname.split("/").pop() || "index.html";
  document.querySelectorAll(".nav a").forEach((a) => {
    if (a.getAttribute("href") === current) {
      a.setAttribute("aria-current", "page");
    }
  });
}

/* ---------- language ---------- */
function setLanguage(lang) {
  currentLang = lang;
  document.documentElement.lang = lang;
  localStorage.setItem("lang", lang);

  // toggle active state
  document.querySelectorAll(".lang-toggle").forEach((btn) => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
  });

  // fill all [data-i18n]
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    let text = (i18n[lang] && i18n[lang][key]) || "";
    // placeholder subst.
    text = text.replace(/\{(\w+)\}/g, (_, k) => (siteData[k] ?? ""));
    el.textContent = text;
  });
}

/* ---------- event delegation ---------- */
function handleClicks(e) {
  const t = e.target;

  // language
  if (t.classList.contains("lang-toggle")) {
    setLanguage(t.dataset.lang);
    return;
  }

  // copy (span id target)
  if (t.matches(".btn.btn-outline.small, .btn.btn-outline, .copy-btn") && (t.getAttribute("onclick") || t.dataset.copy)) {
    // If using data-copy: copy that, else fall back to selector in inline onclick
    const dataCopy = t.dataset.copy;
    if (dataCopy) {
      navigator.clipboard.writeText(dataCopy).then(() => showToast(i18n[currentLang].copied));
    }
    return;
  }

  // simple accordion pattern
  if (t.classList.contains("accordion-button")) {
    const content = t.nextElementSibling;
    if (content) {
      content.style.display = content.style.display === "block" ? "none" : "block";
    }
  }
}

/* ---------- utility copy helper (selector form) ---------- */
function copy(sel) {
  const el = typeof sel === "string" ? document.querySelector(sel) : sel;
  if (!el) return;
  const text = (el.textContent || "").trim();
  if (!text) return;
  navigator.clipboard.writeText(text).then(() => showToast(i18n[currentLang].copied));
}

/* ---------- forms ---------- */
function setupForms() {
  ["donation-form", "volunteer-form", "contact-form"].forEach((id) => {
    const form = document.getElementById(id);
    if (!form) return;

    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const data = Object.fromEntries(new FormData(form).entries());
      const storeKey = id.replace("-form", "") + "Submissions";
      const arr = JSON.parse(localStorage.getItem(storeKey) || "[]");
      arr.push({ date: new Date().toISOString(), data });
      localStorage.setItem(storeKey, JSON.stringify(arr));

      const msgKey =
        id === "donation-form"
          ? "donate_success"
          : id === "volunteer-form"
          ? "volunteer_success"
          : "contact_success";

      showToast(i18n[currentLang][msgKey] || "Saved.");
      form.reset();
    });
  });
}

/* ---------- toast ---------- */
function showToast(msg) {
  let t = document.querySelector(".toast");
  if (!t) {
    t = document.createElement("div");
    t.className = "toast";
    t.setAttribute("aria-live", "polite");
    document.body.appendChild(t);
  }
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 3000);
}

/* ---------- year in footer ---------- */
function updateYear() {
  const el = document.getElementById("year");
  if (el) el.textContent = new Date().getFullYear();
}
